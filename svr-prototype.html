<!DOCTYPE html>
<html lang="en">
	<head>
        <script type="importmap">
            {
                "imports": {
                    "three": "./threejs/build/three.module.js",
                    "VRButton": "./threejs/examples/jsm/webxr/VRButton.js",
                    "GLTFLoader": "./threejs/examples/jsm/loaders/GLTFLoader.js",
					"BoxLineGeometry": "./threejs/examples/jsm/geometries/BoxLineGeometry.js",
					"XRControllerModelFactory": "./threejs/examples/jsm/webxr/XRControllerModelFactory.js"
                }
            }
        </script>
        <style>
            html, body {
                margin: 0;
                height: 100%;
            }

            #c {
                width: 100%;
                height: 100%;
                display: block;
            }
        </style>
    </head>
    <body>
        <script type="module">
            import * as THREE from 'three';

            import { BoxLineGeometry } from 'BoxLineGeometry';
            import { VRButton } from 'VRButton';
            import { XRControllerModelFactory } from 'XRControllerModelFactory';
            import {GLTFLoader} from 'GLTFLoader';
            import {LineBasicMaterial, MeshPhongMaterial, DoubleSide} from 'three';

            let container;
            let camera, scene, raycaster, renderer;
            let controller1, controller2;
			let controllerGrip1, controllerGrip2;
            let room, marker;
            let sphereCenter;
            let radius = 10;

            let intersection, prevPoint;
            let tpStart;

            const tempMatrix = new THREE.Matrix4();

            const fov = 100;
			const aspect = 2;
			const near = 0.1;
			const far = 20;
			const movementTime = 3000 // in ms

            const gltfLoader = new GLTFLoader();
			const url = 'media/gltf/sphere/dodecahedron.gltf';

            init();
            animate();

            function init() {
                container = document.createElement( 'div' );
				document.body.appendChild( container );
                const searchParams = new URLSearchParams(window.location.search);
                if (searchParams.has('radius')) radius = searchParams.get('radius');

                console.log("radius: " + radius);

                scene = new THREE.Scene();
                scene.background = new THREE.Color(0xCCCCCC);

                camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, radius * 2 + 5);
                camera.position.set(0, 1.6, 3);

                // scene.add(new THREE.HemisphereLight(0xCCCCCC, 0x808080));
                // const light = new THREE.AmbientLight( 0x404040 );
                // const light = new THREE.PointLight( 0xff0000, 1, 100 );
                // light.position.set( 50, 50, 50 );
                
                // let light = new THREE.HemisphereLight( 0x606060, 0x404040 );
                
                // let light = new THREE.DirectionalLight( 0xffffff, 0.5 );
                
                // let light = new THREE.AmbientLight( 0x404040 );
                
                let light = new THREE.PointLight( 0x404040 );
                light.position.set( 0, 18, 0 );

                // let light = new THREE.RectAreaLight( 0xffffff, 1,  10, 10 );
                // light.position.set( 0, 20, 0 );
                // light.lookAt( 0, 10, 0 );

                scene.add( light );

                gltfLoader.load(url, (gltf) => {
					room = gltf.scene;
                    room.scale.set(radius / 10, radius / 10, radius / 10);
					scene.add(room);
				});

                raycaster = new THREE.Raycaster();

                renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.outputEncoding = THREE.sRGBEncoding;
				renderer.shadowMap.enabled = true;
				renderer.xr.enabled = true;
				container.appendChild( renderer.domElement );

				document.body.appendChild( VRButton.createButton( renderer ) );
                window.addEventListener( 'resize', onWindowResize );
            }

            function onWindowResize() {

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize( window.innerWidth, window.innerHeight );

            }

            function animate() {
                renderer.setAnimationLoop(render);
            }

            function render() {
                renderer.render(scene, camera);
            }
        </script>
    </body>
</html>